<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <meta name="description" content="Neo Exchange v3 – Ultra Neox | کامل‌ترین صرافی وب ایران | محمد احسان صابری‌زاده">
    <meta name="keywords" content="صرافی,کریپتو,تون,بیتکوین,وب اپ,TON,NFT,هشدار قیمت">
    <meta name="author" content="محمد احسان صابری‌زاده">
    <title>Neo Exchange v3 – Ultra Neox</title>

    <!-- PWA Manifest کامل -->
    <link rel="manifest" href="data:application/manifest+json,{
        \"name\":\"Neo Exchange v3 – Ultra Neox\",
        \"short_name\":\"NeoX\",
        \"start_url\":\".\",
        \"display\":\"standalone\",
        \"background_color\":\"#000000\",
        \"theme_color\":\"#00d4ff\",
        \"orientation\":\"portrait-primary\",
        \"icons\":[
            {\"src\":\"https://cdn.neoexchange.ir/icon-192.png\",\"sizes\":\"192x192\",\"type\":\"image/png\",\"purpose\":\"maskable any\"},
            {\"src\":\"https://cdn.neoexchange.ir/icon-512.png\",\"sizes\":\"512x512\",\"type\":\"image/png\",\"purpose\":\"maskable any\"}
        ]
    }">

    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://cdn.neoexchange.ir/icon-192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://cdn.neoexchange.ir/favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://cdn.neoexchange.ir/favicon-16.png">

    <!-- فونت وزیرمتن کامل -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Font Awesome 6.6.0 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- QR Code Scanner -->
    <script src="https://cdn.jsdelivr.net/npm/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>

    <!-- TON Connect SDK -->
    <script src="https://unpkg.com/@tonconnect/ui@1.0.0/dist/tonconnect-ui.min.js"></script>

    <style>
        :root {
            --bg: #000000;
            --card-bg: rgba(28, 28, 45, 0.55);
            --glass: rgba(255, 255, 255, 0.08);
            --glass-strong: rgba(255, 255, 255, 0.16);
            --glass-border: rgba(255, 255, 255, 0.12);
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --text-muted: #888888;
            --primary: #00d4ff;
            --accent: #7e22ff;
            --success: #00ff88;
            --danger: #ff3366;
            --warning: #ffaa00;
            --blur-strong: blur(32px);
            --blur-light: blur(20px);
            --saturate: saturate(180%);
            --radius-large: 28px;
            --radius-medium: 20px;
            --radius-small: 16px;
        }

        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Vazirmatn', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text-primary);
            min-height: 100dvh;
            background: linear-gradient(135deg, #000000 0%, #0a001f 35%, #001122 100%);
            overflow-x: hidden;
            line-height: 1.6;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            padding-bottom: 100px;
            padding-top: 20px;
        }

        .glass-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 120px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: var(--blur-strong) var(--saturate);
            -webkit-backdrop-filter: var(--blur-strong) var(--saturate);
            border-bottom: 1px solid var(--glass-border);
            z-index: 9999;
            padding-top: 56px;
            text-align: center;
        }

        .logo {
            font-size: 36px;
            font-weight: 900;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1.5px;
            text-shadow: 0 4px 20px rgba(0, 212, 255, 0.3);
        }

        .logo-subtitle {
            font-size: 14px;
            color: #888;
            margin-top: 6px;
            font-weight: 500;
        }

        .glass-card {
            background: var(--card-bg);
            border-radius: var(--radius-large);
            padding: 24px;
            margin: 16px;
            border: 1px solid var(--glass-border);
            backdrop-filter: var(--blur-strong);
            -webkit-backdrop-filter: var(--blur-strong);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7);
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            opacity: 0.8;
        }

        .ios-btn {
            background: var(--glass-strong);
            border: 1px solid var(--glass-border);
            backdrop-filter: var(--blur-light);
            -webkit-backdrop-filter: var(--blur-light);
            color: var(--text-primary);
            font-weight: 600;
            padding: 16px 20px;
            border-radius: var(--radius-medium);
            text-align: center;
            margin: 12px 0;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .ios-btn:active {
            transform: scale(0.96);
            background: rgba(255, 255, 255, 0.25);
        }

        .hidden {
            display: none !important;
        }

        .page {
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- هدر شیشه‌ای ثابت -->
    <div class="glass-header">
        <div class="logo">Neo Exchange</div>
        <div class="logo-subtitle">v3 – Ultra Neox</div>
    </div>

    <div class="container">

        <!-- صفحه خانه -->
        <div id="home" class="page">
            
            <!-- کارت تبدیل سریع -->
            <div class="glass-card">
                <h3 style="text-align:center;margin-bottom:24px;color:var(--primary);font-size:22px;font-weight:700;">
                    تبدیل سریع دلار → TON
                </h3>
                
                <input type="number" id="convertAmount" placeholder="مبلغ به دلار (مثلاً 50)" value="10" 
                       style="font-size:26px;text-align:center;padding:20px;margin-bottom:20px;background:var(--glass-strong);">

                <div style="display:flex;justify-content:center;align-items:center;gap:20px;margin:32px 0;">
                    <div style="text-align:center;">
                        <img src="https://cryptologos.cc/logos/tether-usdt-logo.png?v=029" width="56" height="56" style="border-radius:50%;">
                        <div style="margin-top:8px;font-size:14px;color:#888;">USDT</div>
                    </div>
                    <i class="fas fa-arrow-left fa-3x" style="color:var(--primary);"></i>
                    <div style="text-align:center;">
                        <img src="https://cryptologos.cc/logos/toncoin-ton-logo.png?v=029" width="56" height="56" style="border-radius:50%;">
                        <div style="margin-top:8px;font-size:14px;color:#888;">TON</div>
                    </div>
                </div>

                <div id="convertResult" class="ios-btn" style="font-size:36px;font-weight:900;padding:32px;background:linear-gradient(135deg,var(--primary),var(--accent));color:white;">
                    در حال بارگذاری قیمت...
                </div>
            </div>

            <!-- کارت والت‌ها -->
            <div class="glass-card">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;">
                    <h3 style="font-size:20px;font-weight:700;">
                        آدرس‌های والت (<span id="walletCount">0</span>/۱۲)
                    </h3>
                    <div class="ios-btn" onclick="openScanner()" style="padding:14px 32px;font-size:16px;background:var(--success);color:black;font-weight:700;">
                        اسکن QR
                    </div>
                </div>

                <div id="walletGrid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;">
                    <!-- والت‌ها با JS پر میشن -->
                </div>
            </div>

        </div>

        <!-- مودال اسکنر QR -->
        <div id="scannerModal" class="hidden" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.95);z-index:99999;display:grid;place-items:center;">
            <div style="position:absolute;top:20px;right:20px;font-size:42px;color:white;cursor:pointer;z-index:10;" onclick="closeScanner()">×</div>
            <div id="qrReader" style="width:90%;max-width:420px;border-radius:24px;overflow:hidden;"></div>
            <div style="margin-top:24px;color:#888;font-size:14px;">آدرس رو مقابل دوربین بگیر</div>
        </div>
<!-- صفحه بازارها -->
        <div id="markets" class="page hidden">
            <div class="glass-card">
                <div style="position:sticky;top:0;background:rgba(0,0,0,0.75);backdrop-filter:blur(32px);padding:20px;margin:-24px -24px 24px -24px;border-bottom:1px solid var(--glass-border);z-index:10;">
                    <input type="text" id="marketSearch" placeholder="جستجو در ۲۵۰۰ ارز (مثل TON، BTC، ETH، SHIB...)" 
                           style="width:100%;padding:18px 20px;font-size:17px;background:var(--glass-strong);border:none;border-radius:20px;color:white;">
                    <div style="display:flex;justify-content:space-between;margin-top:12px;font-size:14px;color:#888;">
                        <span>۲۵۰۰ ارز زنده</span>
                        <span id="marketCount">در حال بارگذاری...</span>
                    </div>
                </div>

                <div id="marketList" style="max-height:75vh;overflow-y:auto;padding:8px 0;">
                    <!-- ارزها با JS پر میشن -->
                </div>

                <div id="loadingMarket" style="text-align:center;padding:60px;color:#666;font-size:16px;">
                    <i class="fas fa-spinner fa-spin fa-3x"></i><br><br>
                    در حال دریافت ۲۵۰۰ ارز از CoinGecko...
                </div>
            </div>
        </div>

        <!-- صفحه جزئیات ارز (مخفی تا کلیک) -->
        <div id="coinDetail" class="page hidden">
            <div class="glass-card">
                <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;">
                    <div style="display:flex;align-items:center;gap:18px;">
                        <img id="detailIcon" width="64" height="64" style="border-radius:18px;">
                        <div>
                            <h2 id="detailName" style="margin:0;font-size:26px;font-weight:800;"></h2>
                            <div id="detailSymbol" style="color:var(--text-muted);font-size:16px;font-weight:600;"></div>
                        </div>
                    </div>
                    <i class="fas fa-arrow-right fa-2x" style="color:#888;cursor:pointer;" onclick="showPage('markets')"></i>
                </div>

                <div style="text-align:center;margin:36px 0;">
                    <div id="detailPrice" style="font-size:48px;font-weight:900;background:linear-gradient(90deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;">
                        $0.00
                    </div>
                    <div id="detailChange" style="font-size:20px;margin-top:12px;font-weight:700;"></div>
                </div>

                <div style="height:300px;background:rgba(0,0,0,0.4);border-radius:24px;overflow:hidden;margin:32px 0;position:relative;">
                    <img id="detailChart" src="" style="width:100%;height:100%;object-fit:cover;">
                    <div style="position:absolute;top:16px;right:16px;background:rgba(0,0,0,0.7);padding:10px 20px;border-radius:16px;font-size:15px;color:var(--primary);">
                        نمودار ۷ روزه
                    </div>
                </div>

                <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin:32px 0;">
                    <div class="ios-btn" style="text-align:center;padding:20px;">
                        <div style="color:var(--text-muted);font-size:14px;">مارکت کپ</div>
                        <div id="detailMarketCap" style="font-weight:800;font-size:18px;margin-top:8px;">$0</div>
                    </div>
                    <div class="ios-btn" style="text-align:center;padding:20px;">
                        <div style="color:var(--text-muted);font-size:14px;">حجم ۲۴ساعته</div>
                        <div id="detailVolume" style="font-weight:800;font-size:18px;margin-top:8px;">$0</div>
                    </div>
                    <div class="ios-btn" style="text-align:center;padding:20px;">
                        <div style="color:var(--text-muted);font-size:14px;">بالاترین قیمت</div>
                        <div id="detailATH" style="font-weight:800;font-size:18px;margin-top:8px;color:var(--success);">$0</div>
                    </div>
                    <div class="ios-btn" style="text-align:center;padding:20px;">
                        <div style="color:var(--text-muted);font-size:14px;">پایین‌ترین قیمت</div>
                        <div id="detailATL" style="font-weight:800;font-size:18px;margin-top:8px;color:var(--danger);">$0</div>
                    </div>
                </div>

                <div style="display:flex;gap:16px;margin:40px 0;">
                    <div class="ios-btn" style="flex:1;background:var(--success);color:black;font-weight:800;font-size:18px;padding:20px;" onclick="alert('در حال انتقال به درگاه خرید...')">
                        خرید سریع
                    </div>
                    <div class="ios-btn" style="flex:1;background:var(--danger);color:white;font-weight:800;font-size:18px;padding:20px;" onclick="alert('در حال انتقال به درگاه فروش...')">
                        فروش سریع
                    </div>
                </div>

                <div class="ios-btn" onclick="setPriceAlert()" style="background:rgba(255,215,0,0.25);border:2px solid gold;color:gold;font-weight:800;">
                    <i class="fas fa-bell"></i> تنظیم هشدار قیمت
                </div>
            </div>
        </div>
<!-- صفحه NFT Gallery شبکه TON -->
        <div id="nftGallery" class="page hidden">
            <div class="glass-card">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:28px;">
                    <h2 style="color:var(--primary);font-size:24px;font-weight:800;">
                        NFT های من (شبکه TON)
                    </h2>
                    <div class="ios-btn" onclick="connectTonWallet()" style="padding:16px 32px;background:var(--primary);font-weight:800;">
                        <i class="fas fa-wallet"></i> اتصال والت
                    </div>
                </div>

                <div id="tonWalletStatus" style="text-align:center;padding:32px;background:rgba(255,255,255,0.05);border-radius:20px;margin-bottom:24px;">
                    <i class="fas fa-wallet fa-3x" style="color:#444;margin-bottom:16px;"></i>
                    <div style="font-size:18px;color:#888;">والت متصل نیست</div>
                    <div style="font-size:14px;color:#666;margin-top:8px;">Tonkeeper یا TON Connect رو باز کن</div>
                </div>

                <div id="nftGrid" style="display:grid;grid-template-columns:repeat(2,1fr);gap:18px;margin-top:20px;">
                    <div style="grid-column:1/-1;text-align:center;padding:80px;color:#555;font-size:18px;">
                        <i class="fas fa-image fa-4x" style="margin-bottom:20px;color:#333;"></i>
                        <br>هیچ NFTی یافت نشد
                    </div>
                </div>

                <div id="nftLoading" class="hidden" style="text-align:center;padding:60px;">
                    <i class="fas fa-spinner fa-spin fa-4x" style="color:var(--primary);"></i>
                    <div style="margin-top:20px;font-size:18px;color:#888;">در حال دریافت NFTها از GetGems...</div>
                </div>
            </div>
        </div>

        <!-- صفحه هشدارهای قیمت -->
        <div id="alerts" class="page hidden">
            <div class="glass-card">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:28px;">
                    <h2 style="color:var(--primary);font-size:24px;font-weight:800;">
                        هشدارهای قیمت
                    </h2>
                    <div class="ios-btn" onclick="createNewAlert()" style="padding:16px 32px;background:var(--success);color:black;font-weight:800;">
                        <i class="fas fa-plus"></i> هشدار جدید
                    </div>
                </div>

                <div id="alertList" style="margin-top:20px;">
                    <div style="text-align:center;padding:80px;color:#666;">
                        <i class="fas fa-bell-slash fa-4x" style="margin-bottom:20px;"></i>
                        <br>هنوز هیچ هشداری تنظیم نکردی
                        <div style="font-size:14px;margin-top:12px;color:#888;">اولین هشدار رو بساز تا وقتی قیمت رسید بهت خبر بدم</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- صفحه تاریخچه تراکنشات -->
        <div id="history" class="page hidden">
            <div class="glass-card">
                <h2 style="text-align:center;margin-bottom:32px;color:var(--primary);font-size:24px;font-weight:800;">
                    تاریخچه تراکنشات
                </h2>

                <div style="text-align:center;margin-bottom:32px;padding:20px;background:rgba(0,212,255,0.1);border-radius:20px;">
                    <div id="shamsiDate" style="font-size:22px;font-weight:700;color:var(--primary);"></div>
                    <div style="font-size:16px;color:#888;margin-top:8px;">
                        ساعت <span id="tehranTime">--:--</span> تهران
                    </div>
                </div>

                <div id="transactionList">
                    <div style="text-align:center;padding:100px;color:#555;">
                        <i class="fas fa-receipt fa-4x" style="margin-bottom:24px;"></i>
                        <br>هنوز هیچ تراکنشی ثبت نشده
                    </div>
                </div>
            </div>
        </div>
<!-- صفحه تنظیمات -->
        <div id="settings" class="page hidden">
            <div class="glass-card">
                <h2 style="text-align:center;margin-bottom:36px;color:var(--primary);font-size:26px;font-weight:900;">
                    تنظیمات NeoX
                </h2>

                <!-- تم -->
                <div class="ios-btn" onclick="cycleTheme()" style="padding:24px;margin-bottom:20px;">
                    <div style="display:flex;align-items:center;justify-content:space-between;">
                        <div style="display:flex;align-items:center;gap:20px;">
                            <i class="fas fa-palette fa-2x" style="color:var(--primary);"></i>
                            <div>
                                <div style="font-weight:700;font-size:18px;">تم برنامه</div>
                                <div style="color:#888;font-size:14px;">تغییر ظاهر برنامه</div>
                            </div>
                        </div>
                        <div style="font-weight:800;font-size:18px;" id="currentThemeText">شیشه‌ای NeoX</div>
                    </div>
                </div>

                <!-- زبان -->
                <div class="ios-btn" onclick="toggleLanguage()" style="padding:24px;margin-bottom:20px;">
                    <div style="display:flex;align-items:center;justify-content:space-between;">
                        <div style="display:flex;align-items:center;gap:20px;">
                            <i class="fas fa-language fa-2x" style="color:#00ff88;"></i>
                            <div>
                                <div style="font-weight:700;font-size:18px;">زبان برنامه</div>
                                <div style="color:#888;font-size:14px;">Persian / English</div>
                            </div>
                        </div>
                        <div style="font-weight:800;font-size:18px;" id="currentLangText">فارسی</div>
                    </div>
                </div>

                <!-- نوتیفیکیشن -->
                <div class="ios-btn" onclick="requestNotificationPermission()" style="padding:24px;margin-bottom:20px;">
                    <div style="display:flex;align-items:center;justify-content:space-between;">
                        <div style="display:flex;align-items:center;gap:20px;">
                            <i class="fas fa-bell fa-2x" style="color:#ffaa00;"></i>
                            <div>
                                <div style="font-weight:700;font-size:18px;">نوتیفیکیشن مرورگر</div>
                                <div style="color:#888;font-size:14px;">برای هشدار قیمت</div>
                            </div>
                        </div>
                        <div style="font-weight:800;font-size:18px;" id="notificationStatusText">در انتظار اجازه</div>
                    </div>
                </div>

                <!-- درباره سازنده -->
                <div class="ios-btn" onclick="showPage('about')" style="padding:24px;margin-bottom:40px;">
                    <div style="display:flex;align-items:center;justify-content:space-between;">
                        <div style="display:flex;align-items:center;gap:20px;">
                            <i class="fas fa-heart fa-2x" style="color:#ff3366;"></i>
                            <div>
                                <div style="font-weight:700;font-size:18px;">درباره سازنده</div>
                                <div style="color:#888;font-size:14px;">محمد احسان صابری‌زاده — پایه هشتم</div>
                            </div>
                        </div>
                        <i class="fas fa-chevron-left fa-lg"></i>
                    </div>
                </div>

                <!-- دکمه پاک کردن همه داده‌ها -->
                <div class="ios-btn" onclick="clearAllData()" style="background:#ff3366;border:none;padding:28px;margin-top:40px;font-size:20px;font-weight:900;">
                    <i class="fas fa-trash-alt"></i> پاک کردن همه داده‌ها (والیت، هشدار، تاریخچه)
                </div>

                <div style="text-align:center;margin-top:60px;color:#555;font-size:14px;line-height:2;">
                    Neo Exchange v3 – Ultra Neox<br>
                    نسخه ۳.۰.۰ — آبان ۱۴۰۴<br>
                    ساخته شده با ❤️ و بی‌خوابی توسط<br>
                    <strong style="color:var(--primary);">محمد احسان صابری‌زاده</strong><br>
                    پایه هشتم — بهترین برنامه‌نویس ایران
                </div>
            </div>
        </div>

        <!-- صفحه درباره ما (کاملاً همون چیزی که خواستی) -->
        <div id="about" class="page hidden">
            <div class="glass-card" style="text-align:center;padding:50px 30px;">
                <div style="width:140px;height:140px;background:linear-gradient(135deg,var(--primary),var(--accent));border-radius:50%;margin:0 auto 32px;display:grid;place-items:center;font-size:72px;color:white;font-weight:900;box-shadow:0 20px 40px rgba(0,212,255,0.4);">
                    N
                </div>
                
                <h2 style="margin:32px 0;font-size:30px;background:linear-gradient(90deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:900;">
                    درباره ما
                </h2>
                
                <p style="line-height:2.4;font-size:17px;color:#ddd;margin:40px 0;">
                    این یک پروژه تک‌نفره‌ست که با کمک یک دوست خیلی خوب ساخته شده.<br>
                    زحمت خیلی زیادی براش کشیده شده، شب و روز، بدون خواب، فقط برای اینکه یه چیز درست و حسابی تحویلتون بدم.<br><br>
                    شما با دنبال کردن ما توی شبکه‌های اجتماعی، یه کمک کوچیک به ما می‌کنید که برامون خیلی خیلی خیلی خیلی خیلی بزرگه ❤️
                </p>

                <div style="font-size:32px;margin:40px 0;color:white;line-height:1.8;">
                    دوست‌دار شما همراهان<br>
                    <strong style="background:linear-gradient(90deg,#00d4ff,#ff00aa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-size:38px;">
                        محمد احسان صابری‌زاده — پایه هشتم
                    </strong>
                </div>

                <div style="margin-top:60px;">
                    <p style="margin-bottom:24px;color:#aaa;font-size:16px;">راه‌های ارتباطی</p>
                    
                    <a href="https://t.me/ondbest" target="_blank" class="ios-btn" style="display:flex;align-items:center;justify-content:center;gap:20px;margin:16px 0;padding:20px;font-size:18px;">
                        <i class="fab fa-telegram fa-2x" style="color:#0088cc;"></i>
                        تلگرام
                    </a>
                    
                    <a href="https://instagram.com/e.hs.a_n" target="_blank" class="ios-btn" style="display:flex;align-items:center;justify-content:center;gap:20px;margin:16px 0;padding:20px;font-size:18px;">
                        <i class="fab fa-instagram fa-2x" style="color:#e4405f;"></i>
                        اینستاگرام @e.hs.a_n
                    </a>
                    
                    <a href="https://rubika.ir/thetommy_shelby" target="_blank" class="ios-btn" style="display:flex;align-items:center;justify-content:center;gap:20px;margin:16px 0;padding:20px;font-size:18px;">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="#1abc9c"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                        روبیکا @thetommy_shelby
                    </a>
                </div>

                <div style="margin-top:80px;font-size:15px;color:#444;">
                    ساخته شده با تمام وجود در سال ۱۴۰۴<br>
                    برای بهترین کاربران دنیا ❤️
                </div>
            </div>
        </div>
</div> <!-- پایان container -->

    <!-- منوی پایین شیشه‌ای کامل ۶ تایی -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="showPage('home')">
            <i class="fas fa-home fa-lg"></i>
            <div style="font-size:12px;margin-top:4px;">خانه</div>
        </div>
        <div class="nav-item" onclick="showPage('markets')">
            <i class="fas fa-chart-line fa-lg"></i>
            <div style="font-size:12px;margin-top:4px;">بازارها</div>
        </div>
        <div class="nav-item" onclick="showPage('history')">
            <i class="fas fa-history fa-lg"></i>
            <div style="font-size:12px;margin-top:4px;">تاریخچه</div>
        </div>
        <div class="nav-item" onclick="showPage('nftGallery')">
            <i class="fas fa-gem fa-lg"></i>
            <div style="font-size:12px;margin-top:4px;">NFT</div>
        </div>
        <div class="nav-item" onclick="showPage('alerts')">
            <i class="fas fa-bell fa-lg"></i>
            <div style="font-size:12px;margin-top:4px;">هشدار</div>
        </div>
        <div class="nav-item" onclick="showPage('settings')">
            <i class="fas fa-cog fa-lg"></i>
            <div style="font-size:12px;margin-top:4px;">تنظیمات</div>
        </div>
    </div>

<script>
// === تمام متغیرهای اصلی و کش ===
let prices = {};
let wallets = JSON.parse(localStorage.getItem('neox_wallets') || '[]');
let favorites = JSON.parse(localStorage.getItem('neox_favorites') || '[]');
let priceAlerts = JSON.parse(localStorage.getItem('neox_alerts') || '[]');
let transactions = JSON.parse(localStorage.getItem('neox_transactions') || '[]');
let allCoins = [];
let tonConnected = false;
let tonAddress = '';

// آیکون‌های مهم
const coinIcons = {
    btc: "https://cryptologos.cc/logos/bitcoin-btc-logo.png?v=029",
    eth: "https://cryptologos.cc/logos/ethereum-eth-logo.png?v=029",
    usdt: "https://cryptologos.cc/logos/tether-usdt-logo.png?v=029",
    ton: "https://cryptologos.cc/logos/toncoin-ton-logo.png?v=029",
    sol: "https://cryptologos.cc/logos/solana-sol-logo.png?v=029",
    bnb: "https://cryptologos.cc/logos/bnb-bnb-logo.png?v=029",
    trx: "https://cryptologos.cc/logos/tron-trx-logo.png?v=029",
    doge: "https://cryptologos.cc/logos/dogecoin-doge-logo.png?v=029",
    xrp: "https://cryptologos.cc/logos/xrp-xrp-logo.png?v=029",
    ada: "https://cryptologos.cc/logos/cardano-ada-logo.png?v=029",
    shib: "https://cryptologos.cc/logos/shiba-inu-shib-logo.png?v=029",
    pepe: "https://cryptologos.cc/logos/pepe-pepe-logo.png?v=029",
    not: "https://cryptologos.cc/logos/notcoin-not-logo.png?v=029",
    hmstr: "https://cryptologos.cc/logos/hamster-kombat-hmstr-logo.png?v=029"
};

// === دریافت قیمت‌های اصلی (هر ۸ ثانیه) ===
async function fetchPrices() {
    try {
        const ids = 'bitcoin,ethereum,tether,binancecoin,solana,ripple,the-open-network,dogecoin,cardano,tron,shiba-inu,pepe,notcoin,hamster-kombat';
        const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd&precision=6`);
        const data = await res.json();

        prices = {
            btc: data.bitcoin?.usd || 0,
            eth: data.ethereum?.usd || 0,
            usdt: data.tether?.usd || 1,
            bnb: data.binancecoin?.usd || 0,
            sol: data.solana?.usd || 0,
            xrp: data.ripple?.usd || 0,
            ton: data['the-open-network']?.usd || 0,
            doge: data.dogecoin?.usd || 0,
            ada: data.cardano?.usd || 0,
            trx: data.tron?.usd || 0,
            shib: data['shiba-inu']?.usd || 0,
            pepe: data.pepe?.usd || 0,
            not: data.notcoin?.usd || 0,
            hmstr: data['hamster-kombat']?.usd || 0
        };

        updateConvert();
        if (document.getElementById('markets').classList.contains('hidden') === false) {
            setTimeout(renderMarketList, 1000);
        }
    } catch(e) {
        document.getElementById('convertResult').innerHTML = 'خطا در دریافت قیمت';
    }
}

// === تبدیل زنده دلار → TON ===
function updateConvert() {
    const amount = parseFloat(document.getElementById('convertAmount').value) || 0;
    if (amount <= 0 || !prices.ton) {
        document.getElementById('convertResult').textContent = '0 TON';
        return;
    }
    const tonAmount = (amount / prices.ton).toFixed(4);
    document.getElementById('convertResult').textContent = `${tonAmount} TON`;
}
document.getElementById('convertAmount').addEventListener('input', updateConvert);

// === رندر والت‌ها ===
function renderWallets() {
    const grid = document.getElementById('walletGrid');
    grid.innerHTML = '';
    
    wallets.forEach((w, i) => {
        const div = document.createElement('div');
        div.style.cssText = 'position:relative;background:rgba(255,255,255,0.08);border-radius:20px;padding:16px;text-align:center;border:1px solid rgba(255,255,255,0.1);';
        div.innerHTML = `
            <img src="${coinIcons[w.coin] || coinIcons.usdt}" width="48" height="48" style="border-radius:50%;">
            <div style="margin-top:10px;font-weight:700;font-size:14px;">${w.coin.toUpperCase()}</div>
            <div style="font-size:11px;color:#888;margin-top:4px;word-break:break-all;">${w.addr}</div>
            <div style="position:absolute;top:8px;left:8px;background:#ff3366;color:white;width:24px;height:24px;border-radius:50%;font-size:12px;display:grid;place-items:center;cursor:pointer;" onclick="removeWallet(${i})">×</div>
        `;
        grid.appendChild(div);
    });

    for (let i = wallets.length; i < 12; i++) {
        const empty = document.createElement('div');
        empty.style.cssText = 'border:2px dashed #333;border-radius:20px;display:grid;place-items:center;cursor:pointer;height:100px;';
        empty.innerHTML = '<i class="fas fa-plus fa-2x" style="color:#555;"></i>';
        empty.onclick = openScanner;
        grid.appendChild(empty);
    }

    document.getElementById('walletCount').textContent = wallets.length;
}

function removeWallet(i) {
    if (confirm('مطمئنی می‌خوای این آدرس رو حذف کنی؟')) {
        wallets.splice(i, 1);
        localStorage.setItem('neox_wallets', JSON.stringify(wallets));
        renderWallets();
    }
}
// === اسکنر QR واقعی با html5-qrcode ===
let scannerInstance = null;

function openScanner() {
    document.getElementById('scannerModal').classList.remove('hidden');
    scannerInstance = new Html5QrcodeScanner("qrReader", {
        fps: 15,
        qrbox: { width: 300, height: 300 },
        supportedScanTypes: [Html5QrcodeScanType.SCAN_TYPE_CAMERA],
        showZoomSliderIfSupported: true,
        defaultZoomValueIfSupported: 2,
        showTorchButtonIfSupported: true
    }, false);

    scannerInstance.render(onScanSuccess, onScanError);
}

function closeScanner() {
    document.getElementById('scannerModal').classList.add('hidden');
    if (scannerInstance) {
        scannerInstance.clear();
        scannerInstance = null;
    }
}

function onScanSuccess(decodedText) {
    closeScanner();
    
    if (decodedText.length < 30) {
        alert('آدرس معتبر نیست!');
        return;
    }

    let coin = 'usdt';
    if (decodedText.startsWith('EQ') || decodedText.startsWith('UQ')) coin = 'ton';
    else if (decodedText.startsWith('bc1') || decodedText.startsWith('1') || decodedText.startsWith('3')) coin = 'btc';
    else if (decodedText.startsWith('0x')) coin = 'eth';

    const shortAddr = decodedText.slice(0, 8) + '...' + decodedText.slice(-6);

    if (wallets.length >= 12) {
        alert('حداکثر ۱۲ والت می‌تونی اضافه کنی!');
        return;
    }

    if (wallets.some(w => w.addr === shortAddr)) {
        alert('این آدرس قبلاً اضافه شده!');
        return;
    }

    wallets.push({ coin, addr: shortAddr, full: decodedText });
    localStorage.setItem('neox_wallets', JSON.stringify(wallets));
    renderWallets();
    
    new Notification("والت اضافه شد!", {
        body: `${coin.toUpperCase()}: ${shortAddr}`,
        icon: coinIcons[coin] || coinIcons.usdt
    });
}

function onScanError(err) {
    // بی‌صدا
}

// === اتصال TON Wallet (Tonkeeper / TON Connect) ===
async function connectTonWallet() {
    if (typeof window.ton !== 'undefined') {
        try {
            const accounts = await window.ton.requestAccounts();
            tonAddress = accounts[0];
            tonConnected = true;
            
            document.getElementById('tonWalletStatus').innerHTML = `
                <i class="fas fa-check-circle fa-3x" style="color:#00ff88;margin-bottom:16px;"></i>
                <div style="font-size:20px;font-weight:800;color:var(--success);">والت متصل شد!</div>
                <div style="font-size:14px;color:#888;margin-top:8px;word-break:break-all;">
                    ${tonAddress.slice(0,10)}...${tonAddress.slice(-8)}
                </div>
            `;
            
            loadUserNFTs();
            new Notification("TON Wallet متصل شد", { body: "حالا NFTهات رو می‌بینی!" });
            
        } catch(e) {
            alert('اتصال لغو شد یا خطا رخ داد');
        }
    } else {
        document.getElementById('tonWalletStatus').innerHTML = `
            <div style="padding:32px;background:rgba(255,0,0,0.2);border-radius:20px;">
                <i class="fas fa-exclamation-triangle fa-3x" style="color:#ff3366;margin-bottom:16px;"></i>
                <div style="font-weight:700;font-size:18px;">Tonkeeper نصب نیست!</div>
                <a href="https://tonkeeper.com" target="_blank" class="ios-btn" style="margin-top:20px;display:inline-block;background:#0088cc;">
                    دانلود Tonkeeper
                </a>
            </div>
        `;
    }
}

// === دریافت تمام ۲۵۰۰ ارز از CoinGecko (۱۰ صفحه) ===
async function loadAllCoins() {
    document.getElementById('loadingMarket').classList.remove('hidden');
    
    try {
        let coins = [];
        for (let page = 1; page <= 10; page++) {
            const res = await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=250&page=${page}&sparkline=false&locale=en`);
            const data = await res.json();
            coins = coins.concat(data.map(c => ({
                id: c.id,
                symbol: c.symbol,
                name: c.name,
                price: c.current_price,
                change: c.price_change_percentage_24h
            })));
        }
        
        allCoins = coins;
        document.getElementById('marketCount').textContent = `${allCoins.length} ارز`;
        renderMarketList();
        document.getElementById('loadingMarket').classList.add('hidden');
        
    } catch(e) {
        document.getElementById('marketList').innerHTML = '<div style="text-align:center;padding:60px;color:#ff3366;">خطا در دریافت ارزها</div>';
        document.getElementById('loadingMarket').classList.add('hidden');
    }
}
